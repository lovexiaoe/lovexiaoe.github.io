---
title: 区块链实战-区块链基础
published: false
category: 区块链实战
---

### 区块链基础
![](/assets/blockchainInAction/blockchian-basic-1.png)     
上图说明了区块链技术的历史，经历了40多年的加密，散列，p2p网络，共识协议等方面的科学研究。
比特币说明了一个记录在其基础设施上的事实，不可变分布式账本可以被任何人验证，可以在未知的点之间建立信任，这让受信任的点对点交换成为可能。


#### 从比特币到区块链
区块链技术让向世界上的任何人通过p2p传输数字货币成为可能，并且跨越如银行这样的中间人，还可以向非加密货币的方向扩展，如头衔，契约，音乐，
艺术，密码，企业合同，自动驾驶决策，以及人们劳动产生的艺术品。     
>概念 记录在区块链上的交易包括了一个p2p消息，该消息指定了已执行的操作，操作的参数，消息发送者和接受者，事务费用和记录的时间戳。      

区块链即由数据区块组成的链，每个块存放了多笔交易，每个块中的交易数量不等，可能一百多个，可能几个。每一个块有一个唯一的标识编号。如下图：        
![](/assets/blockchainInAction/blockchian-basic-2.png)          

#### 什么是区块链
区块链是一种让一个去中心化的系统中各方的交易得到信任的技术。其目的是检验和核实由某参与者提出的一个交易，然后执行交易，并在其他参与者
达成共识的前提下记录这些动作的证据。

如下是Bitcoin和Ethereum的区块链栈

![](/assets/blockchainInAction/bitcoin-ethereum-stack.png) 

比特币只有钱包应用，以太坊则将可编程代码成为只能合约。上图也展示了三种层级的编程。
* 协议层： 这一层需要操作区块链本身进行编程，类似与操作系统和网络软件。
* 智能合约层： 这一层需要设计和编写检验和核实的规则，规定需要记录在底层链上的数据和消息。智能合约是代表用户应用驱动区块链的引擎。
* 应用层： 这一层应用包括了web框架和用户接口设计等，属于区块链协议之外。使用web连接到智能合约。

>定义 Dapps是web或者企业应用，调用了区块链中的信任中介功能。Dapps嵌入了一个重要的代码元素，那就是智能合约。对于任何智能合约，
>一个智能合约的复制代码会通过一个特殊交易被传播和部署到区块链网络的参与节点中。
##### 去中心化的核心组件
一个区块链节点承载了如下图中的元素，是区块链应用的基础：

![](/assets/blockchainInAction/blockchain-node-stack.png) 

自下而上的第三层是区块链协议层，它包含了区块链的组件，但是我们不会在这层上编程，下一层是应用逻辑层，在这层我们可以控制
验证 、校验及记录的代码和方法。顶层是用户界面层，web和企业应用程序完成他们的工作。

>定义： 账户account是用于标识交易实体的唯一身份，交易的启动需要账户。

事务由用户提出，多个事务又会组成块，这些事务和块组成了区块链网络的负载，最终经过验证和校验会被记录在分布式账本中。一个区块链网络广播
事务和块的结构如下：

![](/assets/blockchainInAction/nodes-network-1.png) 

一个网络id标识代表了一个拥有节点的区块链网络，如network ID #1，是以太坊的主公共网络，network ID #4 是叫做Rinkeby的公共网络。当你
在网络上部署智能合约的时候，需要指定网络标记。

智能合约会部署在某个区块链节点上的如虚拟机（VM）的沙盒环境中。智能合约类似与面向对象中的一个class。它包含了执行功能的数据，方法，规则。
调用智能合约会产生记录在链上的交易。如果任何的验证和校验规则失败，则方法调用会被回滚。

##### 分布式账本技术（DLT）
首先我们需要知道事务是如何在区块链中被记录的，一组交易会组成一个块，块的集合又组成了链。如下：

![](/assets/blockchainInAction/tx-block-blockchain.png) 

* 在网络上的交易被验证，收集，合并，节点从池中选择一组交易组成一个块。
* 参与者节点使用共识算法达成共识后，让单一一致的交易块附加到已经存在的链上。
* 链上的当前引导块的散列值被添加到新附加的块中，从而创建一个新的链链接。

在区块链中，上一个块的hash会存放在下一个块中，而一旦块中的内容有变，对应的hash值也会变化，这就保证了账本的不可变性。

##### 去中介协议
类似于任何交通系统，需要遵从一些规则，不然交通会陷入瘫痪。区块链定义了以下内容：
* 区块链的结构（交易，块，链）
* 加密，hash,状态管理的基本算法和标准。
* 区块链实现共识和一致的算法。
* 不一致账本下处理异常的技术。
* 区块链代码的执行环境，以及在上下文中，维持一致性，正确性，不可变性的规则。

##### 可信能力
在去中心化的结构中，没有中介，所以是去中心化基础设施，分布式账本技术，去中介协议让整个系统拥有了信任能力。

### 智能合约
一下选择以太坊的智能合约讨论，它是定义智能合约的主流区块链

#### 比特币交易和智能合约交易
如下图，比特币所有的交易都是发送值（Tx(sendValue)）。在智能合约区块链中，一个交易嵌入了由智能合约实现的功能。如投票（Tx(vote)）,
计数（Tx(count)）等。这些函数的调用会被记录在链上。

![](/assets/blockchainInAction/加密货币交易和智能合约交易.png) 

一个智能合约通过一个交易部署到链上，会被永久记录，不可撤销和更改。编辑和运行智能合约的集成环境有remix，使用以太坊的solidity语言。



>定义 智能合约指在一个Dapp中表示一段逻辑的不可变执行代码。智能合约定义的变量和方法就是Dapp用于校验和验证即记录的规则的状态和操作。

#### 区块链编程
有4个重要的概念在区块链中扮演者重要角色。
* 去中心化的基础设施——支持区块链协议，智能合约，Dapps的特殊的软硬件，主要的组成有计算节点和链接这些节点的网络。
* 分布式账本技术——在基础设施之上就是账本。交易和数据被同时记录在利益相关的账本上。所有利益相关者都记录了相同的事实，所以账本是分布式的。
块是一个连着一个的，所以记录是不可变的，防篡改。
* 去中介协议——所有的参与者只需要遵从相同的区块链协议就可通信和交易。并不需要中介。
* 信任确保者——去中心化的各参与方没有中介，因此需要一个实现自动治理的设施。


